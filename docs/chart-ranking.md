
# 模块文档：图表 - 业务分布

- **组件路径(s)**: `src/components/dashboard/charts/ranking-chart.tsx`
- **模块负责人**: `TBD`
- **最后更新**: `2024-08-01`
- **文档版本**: `v1.0.0`
- **变更记录**:
  - `v1.0.0` - 初始创建 by AI Guardian

---

## 1. 核心目标 (Core Objective)
通过可排序的水平条形图，直观地展示所有业务线在单个核心指标上的分布情况和排名，帮助用户快速识别出表现突出或落后的业务线。

## 2. 数据源与模型
- **输入**: `data` (类型为 `ProcessedBusinessData[]`)，包含所有经过筛选和计算的业务线数据。
- **内部状态**: `selectedKpi`，存储用户选择的、用于排名和可视化的 `KpiKey`。
- **派生数据**: `sortedData`，根据 `selectedKpi` 的值对输入的 `data` 进行**降序排序**。

## 3. 核心功能与交互逻辑
### 3.1. 指标选择
- **交互**: 图表顶部提供一个下拉选择器 (`Select`)，允许用户选择任意一个核心KPI作为分布和排序的依据。
- **逻辑**: 选择新KPI会更新 `selectedKpi` 状态，触发 `sortedData` 的重新计算和图表的重渲染。

### 3.2. 图表渲染
- **组件**: 使用 Recharts 的 `BarChart` 组件，并设置 `layout="vertical"` 以创建水平条形图。
- **布局**:
  - **Y轴**: 显示业务线名称。
  - **X轴**: 显示指标数值（X轴本身被隐藏，数值通过标签显示）。
- **颜色**: 每个条形（代表一个业务线）的颜色由其自身的 `variable_cost_ratio` 决定，遵循全局动态风险色系统。
- **数值标签**: 每个条形的末端会通过 `LabelList` 组件直接显示其精确的数值，并使用 `formatKpiValue` 进行格式化，方便快速读取。
- **动态高度**: 为了避免业务线过多时内容拥挤，图表容器的高度会根据业务线的数量动态调整 (`height={sortedData.length * 35 + 50}`)。

### 3.3. 数据洞察 (Tooltip)
- **交互**: 鼠标悬浮在条形上时，会显示一个自定义的工具提示框。
- **内容**: 提示框会显示该业务线的名称、当前所选指标的精确值，以及该业务线的“变动成本率”及其风险颜色。

## 4. 关系图谱 (Relationship Map)
- **关联全局宪法 `PRD.md`**:
  - 条形颜色逻辑严格遵循 `PRD.md §6` 中定义的“动态风险色”系统。
- **与其他模块的交互**:
  - **依赖**:
    - `data-pipeline.md`: 依赖其提供的 `formatKpiValue` 函数和 `KPIS` 配置。
    - `Global UI`: 依赖其颜色系统 (`getDynamicColorByVCR`)。
    - `dashboard-context.md` (间接): 其父组件 `ChartsSection` 从Context获取数据并传递给它。

## 5. 修改与维护指南
- **修改排序方向**: 默认是降序。如果需要升序，可以修改 `sortedData` 的 `.sort()` 方法中的比较逻辑 (`a.kpis[...] - b.kpis[...]`)。
- **调整条形高度**: 动态高度的计算逻辑在 `div` 的 `style` 属性中，可以调整每个条形的高度（`35px`）和基础高度（`50px`）。
